# Electron æ‰“åŒ…ä¸ç‰ˆæœ¬ç®¡ç†æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²é›†æˆç¬¦åˆæœ€ä½³å®è·µçš„è‡ªåŠ¨åŒ– Electron æ‰“åŒ…å’Œç‰ˆæœ¬ç®¡ç†æµç¨‹ï¼Œæ”¯æŒå¤šå¹³å°ï¼ˆmacOSã€Windowsã€Linuxï¼‰æ„å»ºå’Œæ™ºèƒ½ç‰ˆæœ¬å·ç®¡ç†ã€‚

## æ¶æ„æ”¹è¿›

### å·¥ä½œæµç»“æ„

GitHub Actions å·¥ä½œæµåˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„ Jobï¼Œè§£å†³äº†ç«æ€æ¡ä»¶é—®é¢˜ï¼š

1. **Job 1: version** - ç‰ˆæœ¬ç®¡ç†ï¼ˆåªè¿è¡Œä¸€æ¬¡ï¼‰
   - ç¡®å®šç‰ˆæœ¬ç±»å‹
   - æ›´æ–° package.json ç‰ˆæœ¬å·
   - ç”Ÿæˆ Release Notes
   - åˆ›å»º Git Tag å¹¶æ¨é€

2. **Job 2: build** - å¤šå¹³å°æ„å»ºï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
   - macOS (dmg)
   - Windows (portable exe)
   - Linux (AppImage, deb, rpm)
   - ä¸Šä¼ æ„å»ºäº§ç‰©åˆ° Artifacts

3. **Job 3: release** - åˆ›å»º GitHub Release
   - ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
   - åˆ›å»º GitHub Release
   - ä¸Šä¼ æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…

### å…³é”®æ”¹è¿›

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| ç«æ€æ¡ä»¶ | æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ jobï¼Œä½¿ç”¨ job ä¾èµ–å…³ç³» |
| ç‰ˆæœ¬ç®¡ç†æ··ä¹± | ç»Ÿä¸€åœ¨ version job ä¸­ç®¡ç†ç‰ˆæœ¬å· |
| ç¼ºå°‘æ„å»ºç¼“å­˜ | æ·»åŠ  Electron äºŒè¿›åˆ¶æ–‡ä»¶ç¼“å­˜ |
| ç¼ºå°‘ Linux å¹³å° | æ·»åŠ  Linux æ„å»ºæ”¯æŒ |
| Release Notes ç®€å• | è‡ªåŠ¨ä» git log ç”Ÿæˆ changelog |
| ç¼ºå°‘ä»£ç ç­¾å | é¢„ç•™ä»£ç ç­¾åé…ç½®æ¥å£ |

## ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

### é»˜è®¤è¡Œä¸º
- æ¯æ¬¡æ¨é€åˆ° `prod` åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°**å°ç‰ˆæœ¬å·**ï¼ˆpatchï¼‰
- ä¾‹å¦‚ï¼š`2.0.0` â†’ `2.0.1`

### æ§åˆ¶ç‰ˆæœ¬ç±»å‹çš„æ–¹å¼

#### æ–¹å¼ 1: Commit Message å‰ç¼€ â­ æ¨è
åœ¨æäº¤ä¿¡æ¯ä¸­æ·»åŠ ç‰¹å®šå…³é”®è¯æ¥æ§åˆ¶ç‰ˆæœ¬ç±»å‹ï¼š

```bash
# å¤§ç‰ˆæœ¬æ›´æ–° (2.0.0 â†’ 3.0.0)
git commit -m "chore(release): major æ›´æ–°è¯´æ˜"

# ä¸­ç‰ˆæœ¬æ›´æ–° (2.0.0 â†’ 2.1.0)
git commit -m "chore(release): minor æ›´æ–°è¯´æ˜"

# å°ç‰ˆæœ¬æ›´æ–° (2.0.0 â†’ 2.0.1) - é»˜è®¤è¡Œä¸º
git commit -m "chore(release): patch æ›´æ–°è¯´æ˜"
# æˆ–è€…ä¸æ·»åŠ å‰ç¼€ï¼Œé»˜è®¤å°±æ˜¯ patch
```

#### æ–¹å¼ 2: ç‰¹æ®Šåˆ†æ”¯
æ¨é€åˆ°ç‰¹å®šçš„å‘å¸ƒåˆ†æ”¯æ¥è§¦å‘ä¸åŒç‰ˆæœ¬æ›´æ–°ï¼š

```bash
# å¤§ç‰ˆæœ¬æ›´æ–°
git checkout -b release/major
git push origin release/major

# ä¸­ç‰ˆæœ¬æ›´æ–°
git checkout -b release/minor
git push origin release/minor
```

#### æ–¹å¼ 3: GitHub Actions æ‰‹åŠ¨è§¦å‘
1. è¿›å…¥ GitHub ä»“åº“çš„ **Actions** æ ‡ç­¾é¡µ
2. é€‰æ‹© **"Electron Release"** workflow
3. ç‚¹å‡» **"Run workflow"** æŒ‰é’®
4. é€‰æ‹©é…ç½®é¡¹ï¼š
   - **version_type**: `patch` / `minor` / `major`
   - **draft**: æ˜¯å¦åˆ›å»ºä¸ºè‰ç¨¿
   - **pre_release**: æ˜¯å¦æ ‡è®°ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬

#### æ–¹å¼ 4: Git Tag
åˆ›å»º tag æ¥è§¦å‘å‘å¸ƒï¼š

```bash
# æ ‡å‡†ç‰ˆæœ¬å·æ ¼å¼
git tag v2.1.0
git push origin v2.1.0
```

## æœ¬åœ°ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†è„šæœ¬

ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ npm è„šæœ¬åœ¨æœ¬åœ°æ›´æ–°ç‰ˆæœ¬å·ï¼š

```bash
# æ›´æ–°å°ç‰ˆæœ¬å·
pnpm run version:patch

# æ›´æ–°ä¸­ç‰ˆæœ¬å·
pnpm run version:minor

# æ›´æ–°å¤§ç‰ˆæœ¬å·
pnpm run version:major

# è‡ªå®šä¹‰æ›´æ–°ç±»å‹
pnpm run version:bump major
```

## è‡ªåŠ¨åŒ–æµç¨‹

### GitHub Actions å·¥ä½œæµç¨‹

å½“è§¦å‘æ¡ä»¶æ»¡è¶³æ—¶ï¼ŒCI ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

#### Job 1: ç‰ˆæœ¬ç®¡ç†ï¼ˆä»…è¿è¡Œä¸€æ¬¡ï¼‰

1. **ç¡®å®šç‰ˆæœ¬ç±»å‹**ï¼šæ ¹æ®è§¦å‘æ–¹å¼ç¡®å®šæ›´æ–°ç±»å‹
2. **æ›´æ–°ç‰ˆæœ¬å·**ï¼šè‡ªåŠ¨æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
3. **ç”Ÿæˆ Release Notes**ï¼šä» git log è‡ªåŠ¨ç”Ÿæˆæ›´æ–°æ—¥å¿—
4. **æäº¤ç‰ˆæœ¬æ›´æ–°**ï¼šå°†ç‰ˆæœ¬å·å˜æ›´æäº¤å›ä»“åº“
5. **åˆ›å»º Git Tag**ï¼šè‡ªåŠ¨åˆ›å»ºå¹¶æ¨é€ç‰ˆæœ¬æ ‡ç­¾

#### Job 2: å¤šå¹³å°æ„å»ºï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰

ä¸ºä¸‰ä¸ªå¹³å°åŒæ—¶æ„å»ºå®‰è£…åŒ…ï¼š

**macOS**
- æ„å»ºç±»å‹ï¼šDMG
- è¾“å‡ºï¼š`release/sort-visualizer-{version}.dmg`
- æ”¯æŒä»£ç ç­¾å

**Windows**
- æ„å»ºç±»å‹ï¼šPortable (x64, ia32)
- è¾“å‡ºï¼š`release/sort-visualizer-{version}-x64.exe`
- æ”¯æŒä»£ç ç­¾å

**Linux**
- æ„å»ºç±»å‹ï¼šAppImage, deb, rpm
- è¾“å‡ºï¼š`release/sort-visualizer-{version}-x64.AppImage`

#### Job 3: åˆ›å»º Release

1. **ä¸‹è½½æ„å»ºäº§ç‰©**ï¼šä»æ‰€æœ‰å¹³å°ä¸‹è½½ artifacts
2. **åˆ›å»º GitHub Release**ï¼šè‡ªåŠ¨åˆ›å»º Release å¹¶ä¸Šä¼  Release Notes
3. **ä¸Šä¼ å®‰è£…åŒ…**ï¼šå°†æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…ä¸Šä¼ åˆ° Release

### æ„å»ºäº§ç‰©

æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…éƒ½ä¼šï¼š
- ä¸Šä¼ åˆ° GitHub Artifactsï¼ˆä¿ç•™ 30 å¤©ï¼‰
- ä¸Šä¼ åˆ° GitHub Releasesï¼ˆæ°¸ä¹…ä¿ç•™ï¼‰

## Release Notes è‡ªåŠ¨ç”Ÿæˆ

å·¥ä½œæµä¼šè‡ªåŠ¨ä» git log ç”Ÿæˆ Release Notesï¼š

```markdown
## ğŸ“¦ ç‰ˆæœ¬ 2.1.0

**å‘å¸ƒæ—¶é—´**: 2025-12-27 10:30:00 UTC

### ğŸ”„ æ›´æ–°å†…å®¹
- feat: æ·»åŠ æ–°çš„æ’åºç®—æ³•å¯è§†åŒ–
- fix: ä¿®å¤ Windows ä¸‹æ˜¾ç¤ºé—®é¢˜
- chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬

### ğŸ“¥ ä¸‹è½½è¯´æ˜
- **macOS**: ä¸‹è½½ `.dmg` æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…
- **Windows**: ä¸‹è½½ `.exe` æ–‡ä»¶ï¼Œè¿è¡Œå®‰è£…
- **Linux**: ä¸‹è½½ `.AppImage` æˆ– `.deb` æ–‡ä»¶
```

## ä»£ç ç­¾åé…ç½®

### macOS ä»£ç ç­¾å

1. å‡†å¤‡è¯ä¹¦å’Œé…ç½®ï¼š
```bash
# å¯¼å‡ºè¯ä¹¦ä¸º base64
base64 -i YourCert.p12 > cert_base64.txt
```

2. åœ¨ GitHub ä»“åº“æ·»åŠ  Secretsï¼š
- `MAC_CERTS_BASE64`: è¯ä¹¦çš„ base64 ç¼–ç 
- `MAC_CERTS_PASSWORD`: è¯ä¹¦å¯†ç 

### Windows ä»£ç ç­¾å

1. å‡†å¤‡è¯ä¹¦æ–‡ä»¶ï¼ˆ.pfx æˆ– .p12ï¼‰

2. åœ¨ GitHub ä»“åº“æ·»åŠ  Secretsï¼š
- `WIN_CERTIFICATE_BASE64`: è¯ä¹¦çš„ base64 ç¼–ç 
- `WIN_CERTIFICATE_PASSWORD`: è¯ä¹¦å¯†ç 

### æ³¨æ„äº‹é¡¹

- ä»£ç ç­¾åæ˜¯**å¯é€‰çš„**ï¼Œæœªé…ç½®æ—¶ä¼šè·³è¿‡ç­¾åæ­¥éª¤
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ä»£ç ç­¾åä»¥é¿å…å®‰å…¨è­¦å‘Š
- Linux å¹³å°ä¸éœ€è¦ä»£ç ç­¾å

## ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ (Semantic Versioning)ï¼š

- **MAJOR** (ä¸»ç‰ˆæœ¬å·)ï¼šä¸å…¼å®¹çš„ API å˜æ›´
- **MINOR** (æ¬¡ç‰ˆæœ¬å·)ï¼šå‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
- **PATCH** (ä¿®è®¢å·)ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£

## æœ¬åœ°æ‰“åŒ…

å¦‚æœéœ€è¦åœ¨æœ¬åœ°æ‰‹åŠ¨æ‰“åŒ…ï¼š

```bash
# æ‰“åŒ…æ‰€æœ‰å¹³å°ï¼ˆéœ€è¦åœ¨å¯¹åº”å¹³å°ä¸Šæ‰§è¡Œï¼‰
pnpm run electron:build

# ä»…æ‰“åŒ… macOS
pnpm run electron:build --mac

# ä»…æ‰“åŒ… Windows
pnpm run electron:build --win

# ä»…æ‰“åŒ… Linux
pnpm run electron:build --linux

# æ‰“åŒ…å®Œæˆåï¼Œå®‰è£…åŒ…åœ¨ release/ ç›®å½•ä¸‹
```

## æ€§èƒ½ä¼˜åŒ–

### æ„å»ºç¼“å­˜

å·¥ä½œæµå·²é…ç½® Electron äºŒè¿›åˆ¶æ–‡ä»¶ç¼“å­˜ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æ„å»ºæ—¶é—´ï¼š

```yaml
- name: Cache Electron binaries
  uses: actions/cache@v4
  with:
    path: |
      ~/.cache/electron
      ~/.cache/electron-builder
    key: ${{ runner.os }}-electron-${{ hashFiles('**/package-lock.json') }}
```

### å¹¶è¡Œæ„å»º

ä½¿ç”¨ `fail-fast: false` ç¡®ä¿ä¸€ä¸ªå¹³å°å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–å¹³å°ï¼š

```yaml
strategy:
  fail-fast: false
  matrix:
    os: [macos-latest, windows-latest, ubuntu-latest]
```

## æ³¨æ„äº‹é¡¹

1. **åˆ†æ”¯ä¿æŠ¤**ï¼šå»ºè®®å¯¹ `prod` åˆ†æ”¯å¯ç”¨ä¿æŠ¤è§„åˆ™
2. **ç‰ˆæœ¬å†²çª**ï¼šå¦‚æœæœ¬åœ°å’Œè¿œç¨‹ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œè¯·å…ˆæ‹‰å–æœ€æ–°ä»£ç 
3. **æ„å»ºæƒé™**ï¼šç¡®ä¿ GitHub Token æœ‰è¶³å¤Ÿçš„æƒé™ï¼ˆ`contents: write`ï¼‰
4. **å¤šå¹³å°æ„å»º**ï¼š
   - macOS æ„å»ºå¿…é¡»åœ¨ macOS runner ä¸Šè¿›è¡Œ
   - Windows æ„å»ºå¿…é¡»åœ¨ Windows runner ä¸Šè¿›è¡Œ
   - Linux æ„å»ºå¿…é¡»åœ¨ Ubuntu runner ä¸Šè¿›è¡Œ
5. **ç‰ˆæœ¬å›é€€**ï¼šå¦‚éœ€å›é€€ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ `git revert` æˆ–æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·

## æ•…éšœæ’æŸ¥

### å·¥ä½œæµå¤±è´¥

**ç‰ˆæœ¬å·æ²¡æœ‰æ›´æ–°**
- æ£€æŸ¥ commit message æ ¼å¼æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹ Actions æ—¥å¿—ç¡®è®¤ç‰ˆæœ¬ç±»å‹åˆ¤æ–­é€»è¾‘

**æ„å»ºå¤±è´¥**
- æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…å®Œæ•´
- æŸ¥çœ‹ build æ­¥éª¤çš„è¯¦ç»†é”™è¯¯æ—¥å¿—
- ç¡®è®¤ node ç‰ˆæœ¬æ˜¯å¦å…¼å®¹

**Release åˆ›å»ºå¤±è´¥**
- ç¡®è®¤ GitHub Token æƒé™
- æ£€æŸ¥ tag æ˜¯å¦å·²å­˜åœ¨
- éªŒè¯ Release Notes æ ¼å¼

### æœ¬åœ°æ„å»ºé—®é¢˜

**macOS æ„å»ºå¤±è´¥**
```bash
# æ¸…ç†ç¼“å­˜
rm -rf ~/.cache/electron
rm -rf ~/.cache/electron-builder

# é‡æ–°æ„å»º
pnpm run electron:build --mac
```

**Windows æ„å»ºå¤±è´¥**
- ç¡®ä¿å·²å®‰è£… Windows SDK
- æ£€æŸ¥é˜²ç—…æ¯’è½¯ä»¶æ˜¯å¦é˜»æ­¢

**Linux æ„å»ºå¤±è´¥**
```bash
# å®‰è£…ä¾èµ–
sudo apt-get update
sudo apt-get install -y rpmsign libnss3-tools

# é‡æ–°æ„å»º
pnpm run electron:build --linux
```

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1: æ—¥å¸¸ bug ä¿®å¤ï¼ˆå°ç‰ˆæœ¬ï¼‰
```bash
# 1. ä¿®å¤ bug
git add .
git commit -m "fix: ä¿®å¤æ’åºç®—æ³•æ˜¾ç¤ºé”™è¯¯"

# 2. æ¨é€åˆ° prod åˆ†æ”¯ï¼ˆè‡ªåŠ¨ patch ç‰ˆæœ¬æ›´æ–°ï¼‰
git push origin prod
# ç‰ˆæœ¬ä¼šä» 2.0.0 è‡ªåŠ¨æ›´æ–°åˆ° 2.0.1
```

### åœºæ™¯ 2: æ–°åŠŸèƒ½å‘å¸ƒï¼ˆä¸­ç‰ˆæœ¬ï¼‰
```bash
# 1. å¼€å‘æ–°åŠŸèƒ½
git add .
git commit -m "feat: æ·»åŠ æ–°çš„æ’åºç®—æ³•å¯è§†åŒ–"
git commit -m "chore(release): minor å‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬"

# 2. æ¨é€åˆ° prod åˆ†æ”¯
git push origin prod
# ç‰ˆæœ¬ä¼šä» 2.0.1 è‡ªåŠ¨æ›´æ–°åˆ° 2.1.0
```

### åœºæ™¯ 3: é‡å¤§æ›´æ–°ï¼ˆå¤§ç‰ˆæœ¬ï¼‰
```bash
# 1. é‡å¤§é‡æ„
git add .
git commit -m "feat!: é‡æ„æ ¸å¿ƒæ¶æ„ï¼Œä¸å…¼å®¹æ—§ç‰ˆæœ¬"
git commit -m "chore(release): major é‡å¤§ç‰ˆæœ¬æ›´æ–°"

# 2. æ¨é€åˆ° prod åˆ†æ”¯
git push origin prod
# ç‰ˆæœ¬ä¼šä» 2.1.0 è‡ªåŠ¨æ›´æ–°åˆ° 3.0.0
```

### åœºæ™¯ 4: ä½¿ç”¨æ‰‹åŠ¨è§¦å‘åˆ›å»ºè‰ç¨¿ Release
```bash
# 1. æ¨é€ä»£ç 
git push origin prod

# 2. åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘
# - é€‰æ‹© version_type: minor
# - å‹¾é€‰ draft: true
# - å‹¾é€‰ pre_release: false

# 3. æ£€æŸ¥ Releaseï¼Œç¼–è¾‘åå‘å¸ƒ
```

## æœ€ä½³å®è·µæ€»ç»“

1. âœ… ä½¿ç”¨ Job ä¾èµ–å…³ç³»é¿å…ç«æ€æ¡ä»¶
2. âœ… ç‰ˆæœ¬ç®¡ç†é›†ä¸­åœ¨å•ä¸€ Job ä¸­
3. âœ… å¹¶è¡Œæ„å»ºå¤šå¹³å°ä»¥èŠ‚çœæ—¶é—´
4. âœ… ä½¿ç”¨ç¼“å­˜åŠ é€Ÿæ„å»ºè¿‡ç¨‹
5. âœ… è‡ªåŠ¨ç”Ÿæˆ Release Notes
6. âœ… é¢„ç•™ä»£ç ç­¾åæ¥å£
7. âœ… æ”¯æŒ Linux å¹³å°
8. âœ… æä¾›å¤šç§ç‰ˆæœ¬æ§åˆ¶æ–¹å¼
9. âœ… è¯¦ç»†çš„ GitHub Actions Summary
10. âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

## ç›¸å…³æ–‡ä»¶

- `.github/workflows/electron-release.yml` - GitHub Actions é…ç½®
- `scripts/bump-version.js` - ç‰ˆæœ¬ç®¡ç†è„šæœ¬
- `package.json` - é¡¹ç›®é…ç½®å’Œç‰ˆæœ¬å·
- `docs/RELEASE.md` - æœ¬æ–‡æ¡£

## å‚è€ƒèµ„æº

- [Electron Builder æ–‡æ¡£](https://www.electron.build/)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)
